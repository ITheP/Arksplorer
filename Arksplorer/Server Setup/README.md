# Server setup
Arksplorer works by reading data generated by another package called ArkViewer, which is hosted on a web site for Arksplorer to read.

Note that the links below were correct at the time of writing. If they have changed since then, you may have to hunt down the latest version. We will update here when we
get updated information!

ArkViewer (by Miragedmuk - https://github.com/miragedmuk/ARKViewer-Master) can generate data that includes things
like the location of all wild/tame dinos, and chuck it out in a json format for usage elsewhere.

The json data files are hosted on a web site where Arksplorer can access it, and feed it into a friendly interface for players to use.
To make it data available on a web site, you need to be running one! That is beyond the scope of this document. Hopefully you already run one for your server :)

Arksplorer requires a few things setting up on the server and web site to operate properly.

The following is based onthe setup of the Wiredcat Ark server (Thanks DuoMog who runs it for all the help/info/scripts!).
You may need to change things to fit your set up. It also assumes you have a reasonable level of knowledge of windows and are able to understand
and make basic edits to batch files if neccessary.

## ArkViewer

Install ArkViewer. Installing it is nothing more than copying the files to a preferred location.
The latest pre-compiled version at time of documenting can be found at http://www.miragesoftware.co.uk/Ark/Apps/ArkViewer2021-4.zip

The install location we use is `C:\ArkTools\ArkViewer2021_4_20210502` which is also set in the `RunDinoListingOnSaveFile.bat` batch file.
If your ArkViewer install location is different to this, please change the batch file accordingly.

Miragedmuk has brilliantly made it open source as well, so you can also get the source code - especially
good if you want to compile the latest version. You can find it at https://github.com/miragedmuk/ARKViewer-Master

You can find further posts about ArkViewer on the official Ark Forums https://survivetheark.com/index.php?/forums/

## Generating the data

### Rebooting.txt file
Firstly, on the Wiredcat server, there is a script that runs when the server boots that creates backups of maps, does wildcard stuff, starts things up,
etc. and it is likely you have an equivalent for the physical server you run your Ark server on.

When there is a server reboot, the Wiredcat server also runs a script which restarts the server in a controlled way.

The reboot script creates a file called `\ArkServer\Rebooting.txt`
The startup script deletes any file called `\ArkServer\Rebooting.txt`

This file is used as a simple flag by the batch file `RunDinoListing.bat` to check if the server is being rebooted - and if it is, make sure the batch file stops running.
It is recommended that you have the same mechanism in place, and edit the `RunDinoListing.bat` file if the location/filename is different to the above.
This should stop the batch files from processing during a reboot.

### Batch files

Copy the `RunDinoListing.bat` and `RunDinoListingOnSaveFile.bat` files (included in same folder as this file) to where you want to run them from.
In our case we use `c:\ArkServer\`
If you dont want to copy the files to that location, please check the batch files for any changes you might need to make to reference your preferred path instead.

### Review batch files

Review both the .bat files above, check if they look ok and also check the comments for anything you might need to twiddle.
`RunDinoListing.bat` basically just polls for updated saved game data, and when found then runs `RunDinoListingOnSaveFile.bat`
to create the json data we want, once for each map.

### Running the batch files

When your physical server boots into Windows, you need to start up the `RunDinoList.bat` batch file.
In our case, we simply press the `Windows`+`R` keys to get a standard windows Run dialog to appear, and enter shell:startup
and click ok. In the explorer window that appears, we put a short cut to the RunDinoListing.bat batch file.
Note that is is a short cut, not the file itself. You can do this by right clicking in windows explorer, going to New -> Shortcut etc. and creating
a shortcut to your batch file.

Alternatively you can always run this file in another way if you prefer, for example adding it to other start up scripts you have.

This file will run in the background, checking for updated save data every 60 seconds. Note that while waiting the script doesn't use any resources/cpu,
it only uses resource/cpu when there is data to process.

### Json export destination

In `RunDinoListingOnSaveFile.bat` a destination is required for where the generated .json data files are saved. We use `Z:\Apache24\htdocs`
but you can replace this with any other folder. We run a web server on the same server that runs the Ark server, and the path above
just points to where the web site files are stored.

If you need to host this data somewhere fancy or get these data files onto an external web site somewhere, then you will have to do this yourself separately.

### So what happens...

When the above is up and running, you should end up with

- Your server boots up
- It starts a batch file that checks for updated saved Ark data every 60 seconds
- When this happens, the batch files run ArkViewer and generates relevant .json files
    - Wild.json      <-- where all wild dinos are
    - Dinos.json     <-- where all tame dinos are
    - Survivors.json <-- where all survivors are
    - Timestamp.json <-- this is a special extra .json file generated that just has a timestamp when the data was last refreshed
    - These are generated on a per-map basis.
- These are saved in a folder your web server points to
- Arksplorer can then connect to your website and download all that lovely dino data!
- If you reboot your server using a relevant script, then no more data will be processed by the batch files - i.e. they won't interfear with any shut down procedures or processing

### The web site structure

Data will be exported with the following path structure...
`\your.web.site.folder.where.you.want.the.files.storing\<mapname>\<jsonfile>.json`

How your web site presents these files will of course be specific to how you have your web site set up.

In our case, e.g. for the Ragnarok map our URL is
- http://wiredcat.hopto.org/WiredcatRagnarok/

The data files above appear as...
- http://wiredcat.hopto.org/WiredcatRagnarok/Wild.json
- http://wiredcat.hopto.org/WiredcatRagnarok/Dinos.json
- http://wiredcat.hopto.org/WiredcatRagnarok/Survivors.json
- http://wiredcat.hopto.org/WiredcatRagnarok/timestamp.json

There are equivalent URL's for other maps.

Make sure you use your own server URL's instead of the above!

## Arksplorer server side configuration

You also need to host the file `ArksplorerData.json` on the web site.

This file is used by Arksplorer when it starts up to load in a bit of information about your server along with what your websites URL's
are (see above). This means that end users don't have to worry about configurations - its controlled your end, and you can change it as required.

An example `ArksplorerData.json` is included in the same folder as this file. You will need to review and update this file specific to your server. This includes
    - Data describing your server
    - The configuration options (named as they are in Ark Server settings)
    - The .json filenames for the types of data generated (realistically you won't touch this unless you change your batch files to export to different filenames)
    - The maps - take away any maps you dont support, add in any extra maps that are missing
        - The BaseUrl points to your web sites folder for each map. In our case, for example, http://wiredcat.hopto.org/WiredcatIsland/ for our island map

Make sure you use your own server URL's instead of the above!

## Letting the client know about your server

### Doing it yourself

Define a .json file containing the following information...

```json
[
    {
        "Name": "WiredCat",
        "Website": "http://wiredcat.hopto.org/",
        "Url": "http://wiredcat.hopto.org/ArksplorerData.json"
    }
]
```

You will need to replace the information above with your specific equivalents...
- Name: The name of your ark server
- Website: Your public facing web site (so users can find you easily if they want to go looking)
- Url: The exact Url to the ArksplorerData.json file you are hosting

You can then give a copy of the .json file you have just defined to your players to copy into their `.../Arksplorer/Servers/` folder.
Arskplorer scans this folder when it starts up and picks up any .json server definition files and adds them into its interface for your players to select from.

There are are example `YourServer.json` and `YourServers.json` files provided here you can look at, for both a single server and multi server set up.
You can specify as many servers as you want in a multi-server variant - it is nothing more than a json list of server information.

### Getting us to add your server information

You can also pass on the Name, Website and Url details to us, and we can add this to our predefined list of servers. Your players won't need to copy anything to anywhere then,
just a version of Arksplorer with this data put into it.

We highly recommend you try the *do it yourself* version described earlier first to make sure it works before passing any details on to us.

### Arksplorer process overview

When all the above is set up and in place...
- Player starts Arksplorer
- Arksplorer reads in the server list + any server configuration files the player has manually added into /Servers/
- Servers are displayed in a drop down list of sites players can select from
- Player selects a server from the list
- Arksplorer will go get the config file from your server, so it knows where to read all your .json files from
- Magic!

Good luck :)
